<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>

<body>
<div id="success">
    <span id="success-message"></span>
    <button id="payButton" style="display: none;">Opłać rezerwację</button>
</div>

<div id="form">
    <h2>Zapisz się na webinar już dziś!</h2>

    <form id="webinarForm">
        <label for="firstName">Imię:</label>
        <input type="text" id="firstName" name="firstName" required>

        <label for="lastName">Nazwisko:</label>
        <input type="text" id="lastName" name="lastName" required>

        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required>

        <label for="webinarId">Temat webinaru:</label>
        <select id="webinarId" name="webinarId" required>
            <option value=1>Programowanie</option>
            <option value=2>Nowoczesny HTML</option>
            <option value=3>Docker w praktyce</option>
            <option value=4>Azure od postaw</option>
            <option value=5>Mikroserwisy w .NET</option>
            <option value=6>Databricks - wprowadzenie</option>
        </select>

        <button type="submit">Zatwierdź</button>
    </form>
</div>

<div id="paymentForm" style="display: none;">
    <h2>Podaj dane do płatności</h2>
    <form id="creditCardForm">
        <label for="cardHolderName">Imię i nazwisko posiadacza karty:</label>
        <input type="text" id="cardHolderName" name="cardHolderName" required>

        <label for="cardNumber">Numer karty:</label>
        <input type="text" id="cardNumber" name="cardNumber" required pattern="\d{16}"
               placeholder="1234 5678 9012 3456">

        <label for="expiryDate">Data ważności:</label>
        <input type="text" id="expiryDate" name="expiryDate" required placeholder="MM/RR" pattern="\d{2}/\d{2}">

        <label for="cvc">Kod CVC:</label>
        <input type="text" id="cvc" name="cvc" required pattern="\d{3}" placeholder="123">

        <button type="submit">Zapłać</button>
    </form>
</div>

<div id="thankYouMessage" style="display: none;">
    <h2>Płatność zakończona sukcesem. Dziękujemy!</h2>
</div>

<script>
    $('#webinarForm').on('submit', function (event) {
        event.preventDefault();

        const formData = {
            firstName: $('#firstName').val(),
            lastName: $('#lastName').val(),
            email: $('#email').val(),
            webinarId: Number($('#webinarId').val())
        };

        $.ajax("/start", {
            data: JSON.stringify(formData),
            contentType: 'application/json',
            type: 'POST',
            success: function (data) {
                $('#webinarForm')[0].reset();

                $('#form').fadeOut(500, function () {
                    $('#success-message').html("Aplikacja zarejestrowana. Decyzja zostanie przekazana na podany adres email.");
                    $('#success').fadeIn();
                    $('#payButton').fadeIn();
                });
            }
        });
    });

    $('#payButton').on('click', function () {
        $('#success').fadeOut(500, function () {
            $('#paymentForm').fadeIn();
        });
    });

    $('#creditCardForm').on('submit', function (event) {
        event.preventDefault();

        const paymentData = {
            cardHolderName: $('#cardHolderName').val(),
            cardNumber: $('#cardNumber').val(),
            expiryDate: $('#expiryDate').val(),
            cvc: $('#cvc').val()
        };

        $.ajax("/start", { //todo zmienić na /payment
            data: JSON.stringify(paymentData),
            contentType: 'application/json',
            type: 'POST',
            success: function (data) {
                $('#creditCardForm')[0].reset();
                $('#paymentForm').fadeOut(500, function () {
                    $('#thankYouMessage').fadeIn();
                });
            },
            error: function (jqXHR, textStatus, errorThrown) {
                console.error("Błąd podczas przetwarzania płatności:", textStatus, errorThrown);
                alert("Wystąpił błąd podczas przetwarzania płatności. Spróbuj ponownie.");
            }
        });
    });
</script>
</body>
</html>
